{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useRecoilState } from 'recoil';\nimport { history } from '_helpers';\nimport { authAtom } from '_state';\nexport { useFetchWrapper };\n\nfunction useFetchWrapper() {\n  _s();\n\n  const [auth, setAuth] = useRecoilState(authAtom);\n  return {\n    get: request('GET'),\n    post: request('POST'),\n    put: request('PUT'),\n    delete: request('DELETE')\n  };\n\n  function request(method) {\n    return (url, body) => {\n      const requestOptions = {\n        method,\n        headers: authHeader(url)\n      };\n\n      if (body) {\n        requestOptions.headers['Content-Type'] = 'application/json';\n        requestOptions.body = JSON.stringify(body);\n      }\n\n      return fetch(url, requestOptions).then(handleResponse);\n    };\n  } // helper functions\n\n\n  function authHeader(url) {\n    // return auth header with jwt if user is logged in and request is to the api url\n    const token = auth === null || auth === void 0 ? void 0 : auth.token;\n    const isLoggedIn = !!token;\n    const isApiUrl = url.startsWith(process.env.REACT_APP_API_URL);\n\n    if (isLoggedIn && isApiUrl) {\n      return {\n        Authorization: `Bearer ${token}`\n      };\n    } else {\n      return {};\n    }\n  }\n\n  function handleResponse(response) {\n    return response.text().then(text => {\n      const data = text && JSON.parse(text);\n\n      if (!response.ok) {\n        if ([401, 403].includes(response.status) && auth !== null && auth !== void 0 && auth.token) {\n          // auto logout if 401 Unauthorized or 403 Forbidden response returned from api\n          localStorage.removeItem('user');\n          setAuth(null);\n          history.push('/login');\n        }\n\n        const error = data && data.message || response.statusText;\n        return Promise.reject(error);\n      }\n\n      return data;\n    });\n  }\n}\n\n_s(useFetchWrapper, \"9ob9EiE9ZQHKFDbqYW6PcyDBkIc=\", false, function () {\n  return [useRecoilState];\n});","map":{"version":3,"sources":["/Users/lawson/code/newboba/boba/frontend-node/src/_helpers/fetch-wrapper.js"],"names":["useRecoilState","history","authAtom","useFetchWrapper","auth","setAuth","get","request","post","put","delete","method","url","body","requestOptions","headers","authHeader","JSON","stringify","fetch","then","handleResponse","token","isLoggedIn","isApiUrl","startsWith","process","env","REACT_APP_API_URL","Authorization","response","text","data","parse","ok","includes","status","localStorage","removeItem","push","error","message","statusText","Promise","reject"],"mappings":";;AAAA,SAASA,cAAT,QAA+B,QAA/B;AAEA,SAASC,OAAT,QAAwB,UAAxB;AACA,SAASC,QAAT,QAAyB,QAAzB;AAEA,SAASC,eAAT;;AAEA,SAASA,eAAT,GAA2B;AAAA;;AACvB,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBL,cAAc,CAACE,QAAD,CAAtC;AAEA,SAAO;AACHI,IAAAA,GAAG,EAAEC,OAAO,CAAC,KAAD,CADT;AAEHC,IAAAA,IAAI,EAAED,OAAO,CAAC,MAAD,CAFV;AAGHE,IAAAA,GAAG,EAAEF,OAAO,CAAC,KAAD,CAHT;AAIHG,IAAAA,MAAM,EAAEH,OAAO,CAAC,QAAD;AAJZ,GAAP;;AAOA,WAASA,OAAT,CAAiBI,MAAjB,EAAyB;AACrB,WAAO,CAACC,GAAD,EAAMC,IAAN,KAAe;AAClB,YAAMC,cAAc,GAAG;AACnBH,QAAAA,MADmB;AAEnBI,QAAAA,OAAO,EAAEC,UAAU,CAACJ,GAAD;AAFA,OAAvB;;AAIA,UAAIC,IAAJ,EAAU;AACNC,QAAAA,cAAc,CAACC,OAAf,CAAuB,cAAvB,IAAyC,kBAAzC;AACAD,QAAAA,cAAc,CAACD,IAAf,GAAsBI,IAAI,CAACC,SAAL,CAAeL,IAAf,CAAtB;AACH;;AACD,aAAOM,KAAK,CAACP,GAAD,EAAME,cAAN,CAAL,CAA2BM,IAA3B,CAAgCC,cAAhC,CAAP;AACH,KAVD;AAWH,GAtBsB,CAwBvB;;;AAEA,WAASL,UAAT,CAAoBJ,GAApB,EAAyB;AACrB;AACA,UAAMU,KAAK,GAAGlB,IAAH,aAAGA,IAAH,uBAAGA,IAAI,CAAEkB,KAApB;AACA,UAAMC,UAAU,GAAG,CAAC,CAACD,KAArB;AACA,UAAME,QAAQ,GAAGZ,GAAG,CAACa,UAAJ,CAAeC,OAAO,CAACC,GAAR,CAAYC,iBAA3B,CAAjB;;AACA,QAAIL,UAAU,IAAIC,QAAlB,EAA4B;AACxB,aAAO;AAAEK,QAAAA,aAAa,EAAG,UAASP,KAAM;AAAjC,OAAP;AACH,KAFD,MAEO;AACH,aAAO,EAAP;AACH;AACJ;;AAED,WAASD,cAAT,CAAwBS,QAAxB,EAAkC;AAC9B,WAAOA,QAAQ,CAACC,IAAT,GAAgBX,IAAhB,CAAqBW,IAAI,IAAI;AAChC,YAAMC,IAAI,GAAGD,IAAI,IAAId,IAAI,CAACgB,KAAL,CAAWF,IAAX,CAArB;;AAEA,UAAI,CAACD,QAAQ,CAACI,EAAd,EAAkB;AACd,YAAI,CAAC,GAAD,EAAM,GAAN,EAAWC,QAAX,CAAoBL,QAAQ,CAACM,MAA7B,KAAwChC,IAAxC,aAAwCA,IAAxC,eAAwCA,IAAI,CAAEkB,KAAlD,EAAyD;AACrD;AACAe,UAAAA,YAAY,CAACC,UAAb,CAAwB,MAAxB;AACAjC,UAAAA,OAAO,CAAC,IAAD,CAAP;AACAJ,UAAAA,OAAO,CAACsC,IAAR,CAAa,QAAb;AACH;;AAED,cAAMC,KAAK,GAAIR,IAAI,IAAIA,IAAI,CAACS,OAAd,IAA0BX,QAAQ,CAACY,UAAjD;AACA,eAAOC,OAAO,CAACC,MAAR,CAAeJ,KAAf,CAAP;AACH;;AAED,aAAOR,IAAP;AACH,KAhBM,CAAP;AAiBH;AACJ;;GAzDQ7B,e;UACmBH,c","sourcesContent":["import { useRecoilState } from 'recoil';\n\nimport { history } from '_helpers';\nimport { authAtom } from '_state';\n\nexport { useFetchWrapper };\n\nfunction useFetchWrapper() {\n    const [auth, setAuth] = useRecoilState(authAtom);\n\n    return {\n        get: request('GET'),\n        post: request('POST'),\n        put: request('PUT'),\n        delete: request('DELETE')\n    };\n\n    function request(method) {\n        return (url, body) => {\n            const requestOptions = {\n                method,\n                headers: authHeader(url)\n            };\n            if (body) {\n                requestOptions.headers['Content-Type'] = 'application/json';\n                requestOptions.body = JSON.stringify(body);\n            }\n            return fetch(url, requestOptions).then(handleResponse);\n        }\n    }\n    \n    // helper functions\n    \n    function authHeader(url) {\n        // return auth header with jwt if user is logged in and request is to the api url\n        const token = auth?.token;\n        const isLoggedIn = !!token;\n        const isApiUrl = url.startsWith(process.env.REACT_APP_API_URL);\n        if (isLoggedIn && isApiUrl) {\n            return { Authorization: `Bearer ${token}` };\n        } else {\n            return {};\n        }\n    }\n    \n    function handleResponse(response) {\n        return response.text().then(text => {\n            const data = text && JSON.parse(text);\n            \n            if (!response.ok) {\n                if ([401, 403].includes(response.status) && auth?.token) {\n                    // auto logout if 401 Unauthorized or 403 Forbidden response returned from api\n                    localStorage.removeItem('user');\n                    setAuth(null);\n                    history.push('/login');\n                }\n    \n                const error = (data && data.message) || response.statusText;\n                return Promise.reject(error);\n            }\n    \n            return data;\n        });\n    }    \n}"]},"metadata":{},"sourceType":"module"}